--- Animation Class
-- By Merydian9 / Ally for Hire
-- An animation class for effects

--- SHARED space

ANIMATION = {}
ANIMATION.__index = ANIMATION
ANIMATION._registry = {}

function linear(t)
    return t
end

function easeInQuad(t)
    return t * t
end

function easeInLog(t)
    return math.log(t * 9 + 1) / math.log(10)
end

function makeEaseInLog(strength)
    return function(t)
        local base = strength or 4 
        return math.log(t * (base - 1) + 1) / math.log(base)
    end
end


function easeOutLog(t)
    return 1 - (math.log(10 - t * 9) / math.log(10))
end


function ANIMATION:new(params)
    local obj = setmetatable({}, self)
    
    obj.id         = params.id or nil
    obj.startValue = params.startV or 1
    obj.endValue   = params.endV or 0
    obj.duration   = params.duration or 1
    obj.easing     = params.easing or linear
    obj.startTime  = timer.curtime()
    obj.repeats    = params.repeating or 1
    
    return obj
end

function ANIMATION:get(params)
    local id = params.id
    if self._registry[id] then
        return self._registry[id]
    end

    local anim = ANIMATION:new(params or { id = id })
    anim.id = id
    self._registry[id] = anim
    return anim
end

function ANIMATION:delete(id)
    if type(id) == "string" then
        if self._registry[id] then
            self._registry[id] = nil
            return true
        end
        return false
    elseif self.id then
        if ANIMATION._registry[self.id] then
            ANIMATION._registry[self.id] = nil
            return true
        end
    end
    return false
end


function ANIMATION:getProgress()
    local elapsed = timer.curtime() - self.startTime
    if elapsed <= 0 then return 0 end
    if elapsed >= self.duration then return 1 end
    return elapsed / self.duration
end


function ANIMATION:getValue()
    local progress = self:getProgress()
    
    if progress >= 1 then
        return self.endValue
    end

    local t = self.easing(progress)
    return math.lerp(t, self.startValue, self.endValue)
end

function ANIMATION:isFinished()
    return (timer.curtime() - self.startTime) >= self.duration
end

function ANIMATION:reset()
    self.startTime = timer.curtime()
end